#!/usr/bin/python

import os
import sys
import json

TERM_WIDTH = int(os.getenv('COLUMNS') or 78)

def main():
    # Read JSON from STDIN
    mails = json.load(sys.stdin)

    for m in mails:
        summarize_mail(m)

def summarize_mail(m):
    tags = ' '.join(m['tags'])
    before_subj = "{date:11.11}  {mfrom:18.18}  ".format(
        date = m['date_relative'],
        mfrom = m['headers']['From'])

    print("{before}{subject:{subject_width}.{subject_width}} {tags}".format(
        before = before_subj,
        subject_width = TERM_WIDTH - len(before_subj) - 1 - len(tags),
        subject = m['headers']['Subject'],
        tags = tags))

main()
